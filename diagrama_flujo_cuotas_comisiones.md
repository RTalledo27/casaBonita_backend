# DIAGRAMA DE FLUJO: CUOTAS โ COMISIONES DEL ASESOR

## Flujo Visual del Sistema Casa Bonita

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                           MรDULO DE COBRANZA                               โ
โ                        (Gestiรณn de Cuotas)                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
                          โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  USUARIO PAGA CUOTA #1 DEL CONTRATO CON20257868                            โ
โ  โ payment_schedules.status = 'PAID'                                       โ
โ  โ installment_number = 1                                                  โ
โ  โ Se crea registro en tabla 'payments'                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
                          โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    EVENTO AUTOMรTICO                                       โ
โ  InstallmentPaidEvent se dispara                                           โ
โ  PaymentScheduleObserver detecta el cambio                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
                          โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              BACKEND - VERIFICACIรN AUTOMรTICA                             โ
โ  CommissionPaymentVerificationService.php                                  โ
โ  โ Identifica contrato CON20257868                                         โ
โ  โ Busca comisiones del asesor EMP6303                                     โ
โ  โ Verifica payment_part = 1                                               โ
โ  โ Habilita primera parte de comisiรณn                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
                          โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   MรDULO DE RECURSOS HUMANOS                               โ
โ              (Apartado de Comisiones del Asesor)                           โ
โ                                                                             โ
โ  advisor-commissions-modal.component.ts                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โ  โ  CONTRATO: CON20257868                                  โ               โ
โ  โ  ASESOR: EMP6303                                        โ               โ
โ  โ                                                         โ               โ
โ  โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ              โ               โ
โ  โ  โ PRIMERA PARTE   โ  โ SEGUNDA PARTE   โ              โ               โ
โ  โ  โ โ DISPONIBLE   โ  โ โ BLOQUEADA    โ              โ               โ
โ  โ  โ [Pagar Parte 1] โ  โ [Bloqueado]     โ              โ               โ
โ  โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ              โ               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
                          โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ASESOR HACE CLIC EN "PAGAR PRIMERA PARTE"                                 โ
โ  โ commissions.first_payment_date = NOW()                                  โ
โ  โ commissions.status = 'PARTIALLY_PAID'                                   โ
โ  โ Se registra el pago del 50% de la comisiรณn                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
                          โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  USUARIO PAGA CUOTA #2 DEL CONTRATO CON20257868                            โ
โ  โ payment_schedules.status = 'PAID'                                       โ
โ  โ installment_number = 2                                                  โ
โ  โ Mismo proceso automรกtico se repite                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
                          โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              INTERFAZ ACTUALIZADA AUTOMรTICAMENTE                          โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โ  โ  CONTRATO: CON20257868                                  โ               โ
โ  โ  ASESOR: EMP6303                                        โ               โ
โ  โ                                                         โ               โ
โ  โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ              โ               โ
โ  โ  โ PRIMERA PARTE   โ  โ SEGUNDA PARTE   โ              โ               โ
โ  โ  โ โ PAGADA       โ  โ โ DISPONIBLE   โ              โ               โ
โ  โ  โ [Completada]    โ  โ [Pagar Parte 2] โ              โ               โ
โ  โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ              โ               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
                          โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ASESOR HACE CLIC EN "PAGAR SEGUNDA PARTE"                                 โ
โ  โ commissions.second_payment_date = NOW()                                 โ
โ  โ commissions.status = 'PAID'                                             โ
โ  โ Comisiรณn completamente pagada (100%)                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Puntos Clave de la Integraciรณn

### ๐ Sincronizaciรณn Automรกtica
- **Tiempo Real**: Los cambios se reflejan inmediatamente
- **Sin Intervenciรณn Manual**: El sistema detecta automรกticamente los pagos
- **Consistencia**: Ambos mรณdulos siempre estรกn sincronizados

### ๐ Validaciones de Seguridad
- **Orden Secuencial**: No se puede pagar la segunda parte sin la primera
- **Verificaciรณn de Cuotas**: Solo se habilitan comisiones si las cuotas estรกn pagadas
- **Estados Consistentes**: La interfaz refleja el estado real de la base de datos

### ๐ Mapeo Directo
```
Cuota #1 Pagada โ payment_part = 1 โ Primera Parte Comisiรณn (50%)
Cuota #2 Pagada โ payment_part = 2 โ Segunda Parte Comisiรณn (50%)
```

### ๐ฏ Ejemplo Prรกctico
**Contrato**: CON20257868  
**Asesor**: EMP6303  
**Resultado**: Control total del flujo de pagos desde cuotas hasta comisiones

---

*Este diagrama muestra cรณmo Casa Bonita garantiza que los asesores solo cobren sus comisiones cuando los clientes cumplan con sus obligaciones de pago.*